<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Ashleyan Translator</title>
  </head>
  <body>
    <h1>Proper Ashleyan Translator</h1>
    <label>(Translations and decipherings may not be 100% accurate.)</label><br>
    <label>Noun detection does not work when deciphering, so use your brain a little.</label><br><br>
    <label for="input-string">Enter a message to be translated:</label><br>
    <textarea id="inputText"></textarea rows="5" cols="50"><br>
    <button onclick="encodeText()">Translate</button>
    <button onclick="decodeText()">Decipher</button><br>
    <textarea id="outputText" rows="5" cols="50"></textarea>
    
    <script src="https://unpkg.com/compromise"></script>
    <script>
      // function to encode text
function encodeText() {
    // get user input from text box
    var inputText = document.getElementById("inputText").value;

    // split input into words, punctuation, and whitespace using regular expressions
    var words = inputText.match(/\w+|[^\s\w]+|\s+/g);

    // load detect and replace files
    var xhrDetect = new XMLHttpRequest();
    xhrDetect.open("GET", "detect.txt", false);
    xhrDetect.send();
    var detectWords = xhrDetect.responseText.split("\n");

    var xhrReplace = new XMLHttpRequest();
    xhrReplace.open("GET", "replace.txt", false);
    xhrReplace.send();
    var replaceWords = xhrReplace.responseText.split("\n");

    // loop through words and replace if necessary, preserving capitalization
    for (var i = 0; i < words.length; i++) {
        if (/^\w+$/.test(words[i])) {
            var index = detectWords.indexOf(words[i].toLowerCase().replace(/[\W_]+/g, ''));
            if (index >= 0) {
                var originalWord = words[i];
                var replacementWord = replaceWords[index];
                if (originalWord[0] === originalWord[0].toUpperCase()) {
                    // preserve capitalization of first letter
                    words[i] = replacementWord.charAt(0).toUpperCase() + replacementWord.slice(1);
                } else {
                    words[i] = replacementWord;
                }
            } else {
                var doc = nlp(words[i]);
                if (doc.has('#Person') || doc.has('#Place') || doc.has('#Organization') || doc.has('#ProperNoun')) {
                    // no processing/translation needed for these tags
                } else {
                    // apply custom cipher to every letter in the word
                    var cipheredWord = "";
                    for (var j = 0; j < words[i].length; j++) {
                        var letter = words[i][j];
                        var cipheredLetter = letter;
                        if (letter in cipher) {
                            cipheredLetter = cipher[letter];
                        }
                        cipheredWord += cipheredLetter;
                    }
                    words[i] = cipheredWord;
                }
            }
        }
    }

    // update output text box with encoded or decoded text
    document.getElementById("outputText").value = words.join("");
}

function decodeText() {
    // get user input from text box
    var inputText = document.getElementById("inputText").value;

    // split input into words, punctuation, and whitespace using regular expressions
    var words = inputText.match(/\w+|[^\s\w]+|\s+/g);

    // load detect and replace files
    var xhrDetect = new XMLHttpRequest();
    xhrDetect.open("GET", "replace.txt", false);
    xhrDetect.send();
    var detectWords = xhrDetect.responseText.split("\n");

    var xhrReplace = new XMLHttpRequest();
    xhrReplace.open("GET", "detect.txt", false);
    xhrReplace.send();
    var replaceWords = xhrReplace.responseText.split("\n");

    // loop through words and replace if necessary, preserving capitalization
    for (var i = 0; i < words.length; i++) {
        if (/^\w+$/.test(words[i])) {
            var index = detectWords.indexOf(words[i].toLowerCase().replace(/[\W_]+/g, ''));
            if (index >= 0) {
                var originalWord = words[i];
                var replacementWord = replaceWords[index];
                if (originalWord[0] === originalWord[0].toUpperCase()) {
                    // preserve capitalization of first letter
                    words[i] = replacementWord.charAt(0).toUpperCase() + replacementWord.slice(1);
                } else {
                    words[i] = replacementWord;
                }
            } else {
                // apply decipher to every letter in the word
                var  decipheredWord = "";
                for (var j = 0; j < words[i].length; j++) {
                    var letter = words[i][j];
                    var  decipheredLetter = letter;
                    if (letter in  decipher) {
                         decipheredLetter =  decipher[letter];
                    }
                     decipheredWord +=  decipheredLetter;
                }
                words[i] =  decipheredWord;
            }
        }
    }

    // update output text box with encoded or decoded text
    document.getElementById("outputText").value = words.join("");
}

    // custom cipher objects
    var cipher = {
	'A': 'S', 'B': 'N', 'C': 'V', 'D': 'F', 'E': 'R', 'F': 'G', 'G': 'H', 'H': 'J', 'I': 'O', 'J': 'K', 'K': 'L', 'L': 'A', 'M': 'Z', 'N': 'M', 'O': 'P', 'P': 'Q', 'Q': 'W', 'R': 'T', 'S': 'D', 'T': 'Y', 'U': 'I', 'V': 'B', 'W': 'E', 'X': 'C', 'Y': 'U', 'Z': 'X',
	'a': 's', 'b': 'n', 'c': 'v', 'd': 'f', 'e': 'r', 'f': 'g', 'g': 'h', 'h': 'j', 'i': 'o', 'j': 'k', 'k': 'l', 'l': 'a', 'm': 'z', 'n': 'm', 'o': 'p', 'p': 'q', 'q': 'w', 'r': 't', 's': 'd', 't': 'y', 'u': 'i', 'v': 'b', 'w': 'e', 'x': 'c', 'y': 'u', 'z': 'x'
    };
   var decipher = {
	'A': 'L', 'B': 'V', 'C': 'X', 'D': 'S', 'E': 'W', 'F': 'D', 'G': 'F', 'H': 'G', 'I': 'U', 'J': 'H', 'K': 'J', 'L': 'K', 'M': 'N', 'N': 'B', 'O': 'I', 'P': 'O', 'Q': 'P', 'R': 'E', 'S': 'A', 'T': 'R', 'U': 'Y', 'V': 'C', 'W': 'Q', 'X': 'Z', 'Y': 'T', 'Z': 'M', 
	'a': 'l', 'b': 'v', 'c': 'x', 'd': 's', 'e': 'w', 'f': 'd', 'g': 'f', 'h': 'g', 'i': 'u', 'j': 'h', 'k': 'j', 'l': 'k', 'm': 'n', 'n': 'b', 'o': 'i', 'p': 'o', 'q': 'p', 'r': 'e', 's': 'a', 't': 'r', 'u': 'y', 'v': 'c', 'w': 'q', 'x': 'z', 'y': 't', 'z': 'm'
   };
    </script>
  </body>
</html>
